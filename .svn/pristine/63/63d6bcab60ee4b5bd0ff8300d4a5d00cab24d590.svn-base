@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_ManagerLayout.cshtml";
    ViewData.OpBtnInfo(new OpBtnInfo(hideAdd: true, hideEdit: true, hideDel: true));
    var start = DateTime.Now.ToString("yyyy-MM-01");
    var end = DateTime.Parse(start).AddMonths(1).AddDays(-1).ToString("yyyy-MM-dd");
}

@section search{
    <table class="table-toolbar">
        <tr>
            <td class="label-toolbar">
                <label>日期：</label>
            </td>
            <td class="input-toolbar">
                <input name="date" value="@start" class="datacontrol Wdate" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd'})" />
            </td>
            <td>-</td>
            <td class="input-toolbar">
                <input name="date2" value="@end" class="datacontrol Wdate" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd'})" />
            </td>
            <td class="label-toolbar">
                <label>品类：</label>
            </td>
            <td class="input-toolbar">
                @Form.CategoryCombobox("categorySn", true)
            </td>
            <td class="label-toolbar">
                <label>门店：</label>
            </td>
            <td class="input-toolbar">
                @Form.Combobox("store", ViewBag.stores as List<SelectListItem>, dataOptions: (CurrentUser.IsStore ? "readonly:true," : "") + "editable:false,panelMaxHeight:200")
            </td>
            <td class="label-toolbar">
                <label>关键字：</label>
            </td>
            <td class="input-toolbar">
                <input type="text" class="easyui-textbox" name="searchText" data-options="prompt:'请输入条码或品名...'" />
            </td>
        </tr>
    </table>
}
@section toolbar
{
    <a href="#" class="easyui-linkbutton cus1 linkbtn" data-options="iconCls:'icon-export'" onclick="Export()">导出Excel</a>
}
<script type="text/javascript">
    pharos.manager.geturl = '@Url.Action("QueryInvoicingSummaryPageList")';
    pharos.manager.pagination = true;
    pharos.manager.showFooter = true;
    pharos.manager.columns = [[
        { field: '商品编码', title: '商品编码', width: 80 },
        { field: '商品条码', title: '商品条码', width: 120 },
        { field: '品名', title: '品名', width: 150 },
        { field: '商品类别', title: '商品类别', width: 150 },
        { field: '单位', title: '单位', width: 50 },
        { field: '主供应商', title: '主供应商', width: 80 },
        { field: '采购入库数', title: '采购入库数', width: 80 },
        { field: '采购入库金额', title: '采购入库金额', width: 80 },
        { field: '赠送入库数量', title: '赠送入库数量', width: 90 },
        { field: '赠送入库金额', title: '赠送入库金额', width: 90 },
        { field: '采购退货数量', title: '采购退货数量', width: 90 },
        { field: '采购退货金额', title: '采购退货金额', width: 90 },
        { field: '店内调出数量', title: '店内调出数量', width: 90 },
        { field: '店内调出金额', title: '店内调出金额', width: 90 },
        { field: '店内调入数量', title: '店内调入数量', width: 90 },
        { field: '店内调入金额', title: '店内调入金额', width: 90 },
        { field: '批发销售数', title: '批发销售数', width: 90 },
        { field: '批发销售金额', title: '批发销售金额', width: 90 },
        { field: '批发销售成本', title: '批发销售成本', width: 90 },
        { field: '批发毛利', title: '批发毛利', width: 90 },
        { field: '批发毛利率', title: '批发毛利率', width: 90 },
        { field: '其它出库数量', title: '其它出库数量', width: 90 },
        { field: '其它出库金额', title: '其它出库金额', width: 90 },
        { field: '零售数量', title: '零售数量', width: 90 },
        { field: '零售金额', title: '零售金额', width: 90 },
        { field: '零售成本', title: '零售成本', width: 90 },
        { field: '未税零售成本', title: '未税零售成本', width: 90 },
        { field: '零售毛利', title: '零售毛利', width: 90 },
        { field: '零售毛利率', title: '零售毛利率', width: 90 },
        { field: '销售成本', title: '销售成本', width: 90 },
        { field: '销售毛利', title: '销售毛利', width: 90 },
        { field: '销售毛利率', title: '销售毛利率', width: 90 },
        { field: '其它入库数量', title: '其它入库数量', width: 90 },
        { field: '其它入库金额', title: '其它入库金额', width: 90 },
        { field: '报损数量', title: '报损数量', width: 90 },
        { field: '报损金额', title: '报损金额', width: 90 },
        { field: '盘点盈亏数量', title: '盘点盈亏数量', width: 90 },
        { field: '盘点盈亏金额', title: '盘点盈亏金额', width: 90 },
        { field: '组合数量', title: '组合数量', width: 90 },
        { field: '组合金额', title: '组合金额', width: 90 },
        { field: '拆分数量', title: '拆分数量', width: 90 },
        { field: '拆分金额', title: '拆分金额', width: 90 },
        { field: '结存数量', title: '结存数量', width: 90 },
        { field: '结存金额', title: '结存金额', width: 90 },
        { field: '未税结存金额', title: '未税结存金额', width: 90 }
    ]];
    function Export() {
        var date=$("[name='date']").val();
        if (!date) {
            $.messager.alert("提示", "请先选择日期!"); return;
        }
        window.location.href = '@Url.Action("SaleExport")?type=8&' + $('#frmsearch').serialize();
    }
    var storeIds = [];
    function storeSelect(record) {
        if (record.value) {
            storeIds.remove("");
            storeIds.add(record.value);
        } else {
            storeIds = [];
            storeIds.add(record.value);
        }
        $(this).combobox("setValues", storeIds);
    }
    function storeUnSelect(record) {
        storeIds.remove(record.value);
        $(this).combobox("setValues", storeIds);
    }
</script>