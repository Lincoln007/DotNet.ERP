@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_FormLayout.cshtml";
}
<div class="default-form">
    @using (Html.BeginForm())
    {
        @Html.Hidden("Id")
        @Html.Hidden("Barcode")
        @Html.Hidden("LockStoreID")
        @Html.Hidden("CheckBatch")
        <div class="content">
            <div id="tt1" class="easyui-tabs" data-options="onSelect:function(title,index){if(index==1){appendItemPrice();loadStore();}else if(index==2){appendItemSupp();}}" style="height:auto;">
                <div title=" 基本信息">
                    <table class="table-form" width="100%" height="150px">
                        <tr>
                            <td class="name">盘点门店：</td>
                            <td class="input">@Html.DisplayText("StoreTitle")</td>
                            <td class="name">盘点批次：</td>
                            <td class="input" id="batch">@Html.DisplayText("CheckBatch")</td>
                        </tr>
                        <tr>
                            <td class="name formbox">复盘日期：</td>
                            <td class="input formbox">
                                <input id="date" class="Wdate" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'date2\')}'})" style="width:100px;display:none" />
                                <input name="ActualDate" id="date2" class="Wdate easyui-validatebox" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd',minDate:'#F{$dp.$D(\'date\')}'})" value="@Html.DisplayText("LockDate")" style="width:100px" data-options="required:true" />
                            </td>
                            <td class="name formbox">盘点员：</td>
                            <td class="input formbox">@Html.DropDownList("CheckUID", ViewBag.users as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "width:100" })</td>
                        </tr>
                        <tr>
                            <td class="name">商品条码：</td>
                            <td class="input">@Html.DisplayText("Barcode")</td>
                            <td class="name">品 名：</td>
                            <td class="input">@Html.DisplayText("Title")</td>
                        </tr>
                        <tr>
                            <td class="name">复盘前数量：</td>
                            <td class="input">@Html.DisplayText("InitNumber")</td>
                            <td class="name">实盘数量：</td>
                            <td class="input">@Html.TextBox("ActualNumber", Request["ActualNumber"]=="null" ? "" : Request["ActualNumber"], new { @class = "easyui-validatebox", data_options = "required:true,validType:'intOrFloat'", style = "width:90px" })</td>
                        </tr>
                    </table>
                </div>
                <div title=" 盘点日志">
                    <table class="easyui-datagrid" id="grid"
                           data-options="url:'@Url.Action("TakeStockLogs")',height:230,queryParams:{checkBatch:'@Html.DisplayText("CheckBatch")',barcode:'@Html.DisplayText("Barcode")'},showFooter:false,border:true,rownumbers:true,fit:false,fitColumns:true,pagination:false,singleSelect:true,onLoadError:loadError">
                        <thead>
                            <tr>
                                <th data-options="field:'CheckBatch',hidden:true" width="120">盘点批次</th>
                                <th data-options="field:'Barcode'" width="120">商品条码</th>
                                <th data-options="field:'Number'" width="60">盘点数量</th>
                                <th data-options="field:'Checker'" width="100">盘点员</th>
                                <th data-options="field:'StateTitle'" width="70">盘点方式</th>
                                <th data-options="field:'SourceTitle'" width="70">来源</th>
                                <th data-options="field:'CreateDT'" width="150">盘点时间</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    }
</div>
<script type="text/javascript">
    $(function () {
        var log = "@Request["log"]";
        if (log == "1") {
            $('#tt1').tabs('close', 0).tabs("select", 1);
        }
        var date = $("#batch").html().substr(2, 6);
        $("#date").val("20" + date.substr(0, 2) + "-" + date.substr(2, 2) + "-" + date.substr(4, 2));
    });
</script>
