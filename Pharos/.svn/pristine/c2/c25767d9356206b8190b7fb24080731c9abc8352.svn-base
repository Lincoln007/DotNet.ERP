using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using Pharos.Logic.DAL;

namespace Pharos.Logic.ApiData.Mobile.Repository
{
    internal class SaleOrderDAL:BaseDAL
    {
        public DataTable SaleDetailReport(string storeId,DateTime start,DateTime end)
        {
            string sql = @"SELECT TOP 10 *,dbo.F_ProductNameBybarcode(Barcode) Title FROM (
                SELECT a.Barcode,SUM(a.PurchaseNumber) PurchaseNumber,SUM(a.PurchaseNumber*a.ActualPrice) ActualTotal FROM dbo.SaleDetail a 
                INNER JOIN dbo.SaleOrders b ON a.PaySN=b.PaySN where storeid='{0}' and createdt between '{1}' and '{2}'
                GROUP BY a.Barcode) t ORDER BY t.ActualTotal desc";
            sql = string.Format(sql, storeId, start.ToString("yyyy-MM-dd"), end.ToString("yyyy-MM-dd"));
            return _db.DataTableText(sql, null);
        }
    }
}
