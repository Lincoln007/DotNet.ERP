@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_ManagerLayout.cshtml";
    ViewData.OpBtnInfo(new OpBtnInfo(hideAdd: true, hideEdit: true, hideDel: true, firstLoadData: false));
    var hasModifyAuthority = false;//是否有修改订单权限
}

@section search{
    <input type="hidden" name="type" value="2" />
    <table class="table-toolbar">
        <tr>
            <td class="label-toolbar">
                <label>日期：</label>
            </td>
            <td class="input-toolbar">
                <input name="date" id="date" class="datacontrol Wdate" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'date2\')}'})" value="@DateTime.Now.ToString("yyyy-MM-dd")" style="width:100px" />-
            </td>
            <td class="input-toolbar">
                <input name="date2" id="date2" class="datacontrol Wdate" onclick="WdatePicker({dateFmt: 'yyyy-MM-dd',minDate:'#F{$dp.$D(\'date\')}'})" value="@DateTime.Now.ToString("yyyy-MM-dd")" style="width:100px" />
            </td>
            <td class="label-toolbar">
                <label>批发商：</label>
            </td>
            <td class="input-toolbar">
                @Form.Combobox("supplierId", ViewBag.wholes as List<SelectListItem>, dataOptions: "editable:true,panelMaxHeight:200")
            </td>
        </tr>
    </table>
}
@section toolbar
{
    <a href="#" id="btnExcel" class="easyui-linkbutton cus1 linkbtn" data-options="iconCls:'icon-export'" onclick="Export()">导出Excel</a>
}
<script type="text/javascript">
    var comboload=function (param, success, error) {
        //获取输入的值
        var q = param.q || "";
        //此处q的length代表输入多少个字符后开始查询
        if (q.length <= 1) return false;
        $.ajax({
            url:"@Url.Action("GetDataForSearch","Report")",
            type:"post",
            data:{
                //传值，还是JSON数据搜索
                searchText: q,
                searchField:$("#searchField").combobox("getValue"),
                product:"1"
            },
            //重要，如果写jsonp会报转换错误，此处不写都可以
            dataType:"json",
            success: function (data) {
                var items = $.map(data, function(item){
                    return { value: item.value, text: item.text };
                });
                //执行loader的success方法
                success(items);
            },    //异常处理
            error: function (xml, text, msg) {
                error.apply(this, arguments);
            }
        });
    }
    pharos.manager.editurl = "@Url.Action("SaleOrderDetail")";
    pharos.manager.geturl="@Url.Action("WholesalPageList")";
    pharos.manager.pagination = true;
    pharos.manager.showFooter = true;
    pharos.manager.pageSize = 50;
    pharos.manager.pageList = [50,100,200];
    pharos.manager.columns = [[
        { field: 'Barcode', title: '商品条码', width: 120 },
        { field: 'Title', title: '商品名称', width: 180 },
        { field: 'SubUnit', title: '单位', width: 60 },
        { field: 'VerifyTime', title: '操作日期', width: 100 },
        { field: 'OutboundNumber', title: '批发数量', width: 80 },
        { field: '批发金额', title: '批发金额', width: 100, formatter: numberToFixed },
        { field: 'SaleTotal', title: '零售金额', width: 100, formatter: numberToFixed },
        { field: '未税金额', title: '批发金额(未)', width: 80, formatter: numberToFixed  },
        { field: 'Operator', title: '操作人', width: 80 },
    ]];
    pharos.manager.frozenColumns=[[
        { field: 'ApplyOrg', title: '批发商名称', width: 120 }
    ]]
    pharos.manager.editItem = function (id, row) {
        openDialog("查看详情", "@Url.Action("SaleOrderDetail")?paysn=" + row.PaySN + "&" + $('#frmsearch').serialize(), 1000, 560, @(hasModifyAuthority?"false":"true"));
    };
    pharos.manager.loadSuccess = function () {
        //pharos.manager.$dg.datagrid("autoMergeCellsGroupby", { groupby: 'Id', columns: ['Store', 'CreateDT', 'Cashier', 'Saler', 'PaySNFormat', 'TotalAmount', 'OrderDiscount', 'ApiTitle', 'ApiOrderSN', 'MobilePhone'] });
    }

    function Export() {
        var date = $("[name='date']").val();
        if (!date) {
            $.messager.alert("提示", "请先选择日期!"); return;
        }
        window.location.href = '@Url.Action("SaleExport")?type=23&' + $('#frmsearch').serialize();
    }
    $(function () {
        //$("#btns").append($("#searchBtn")).append($("#btnExcel"));
        //$("#searchBtn").insertAfter($("#btns"));
        //pharos.manager.hideToolbar();
    });
    function closeDialog() { }
</script>