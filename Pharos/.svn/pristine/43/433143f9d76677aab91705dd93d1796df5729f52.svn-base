<Window xmlns:ChildPages="clr-namespace:Pharos.POS.Retailing.ChildPages"  x:Class="Pharos.POS.Retailing.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow" Height="768" Width="1024" Icon="Images\Login\logo.png"
        
          xmlns:local="clr-namespace:Pharos.POS.Retailing"
        xmlns:rules="clr-namespace:Pharos.POS.Retailing.Models.DataRules"
        xmlns:entity="clr-namespace:Pharos.POS.Retailing.Models" WindowStyle="None" Name="mainWindow" 
    WindowState="Maximized" FontFamily="/Pharos.POS.Retailing;component/Fonts/#Microsoft YaHei" >
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles\BaseButtonStyle.xaml"></ResourceDictionary>
                <ResourceDictionary Source="Styles\DataGridStyle.xaml"/>
                <ResourceDictionary Source="Styles\PosStyle.xaml"/>
                <ResourceDictionary Source="Styles\BaseStyle.xaml"></ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.Resources>
            <local:LockConverter x:Key="LockConverter"></local:LockConverter>
            <local:GuaDanNumShowConverter x:Key="GuaDanNumShowConverter"></local:GuaDanNumShowConverter>
        </Grid.Resources>
        <ChildPages:BaseShield Panel.ZIndex="9999" x:Name="lockScreenShield" Visibility="{Binding ShowShield}" BorderThickness="0" Background="Transparent"
            CurrentWindow="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}" 
                         Width="{Binding ElementName=mainWindow,Path=ActualWidth}" 
                         Height="{Binding ElementName=mainWindow,Path=ActualHeight}">
            <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
                <Image Width="200" Visibility="{Binding ShowLockImg}" Source="Images\lock.png" MouseDown="UserLock_MouseDown"></Image>
                <TextBlock  Visibility="{Binding ShowMsg}" Margin="100,250,0,0" FontSize="25" TextAlignment="Center" VerticalAlignment="Center" Foreground="White" HorizontalAlignment="Center" >正在更新数据中...</TextBlock>
            </Grid>
        </ChildPages:BaseShield>
        <Grid Panel.ZIndex="8888">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Offset="1" Color="#7891A5"></GradientStop>
                    <GradientStop Offset="0.5" Color="#bd9c85"></GradientStop>
                    <GradientStop Offset="0" Color="#747589"></GradientStop>

                </LinearGradientBrush>
            </Grid.Background>
            <Grid.RowDefinitions>
                <RowDefinition Height="0"></RowDefinition>
                <RowDefinition Height="500*"></RowDefinition>
                <RowDefinition Height="170"></RowDefinition>
                <RowDefinition Height="50"></RowDefinition>

            </Grid.RowDefinitions>
            <!--Top-->

            <!--Middle -->
            <Grid Grid.Row="1">
                <Grid.Resources>
                    <local:IdToNameConverter x:Key="IdToNameConverter"></local:IdToNameConverter>
                    <local:IsEditConverter x:Key="IsEditConverter"></local:IsEditConverter>
                    <local:OperationConverter x:Key="OperationConverter"></local:OperationConverter>
                </Grid.Resources>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="87*" MinWidth="870"></ColumnDefinition>
                    <ColumnDefinition MaxWidth="180" Width="14*" MinWidth="140"></ColumnDefinition>
                    <ColumnDefinition Width="9"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="80"></RowDefinition>
                    <RowDefinition Height="*"></RowDefinition>
                </Grid.RowDefinitions>
                <Border BorderThickness="5"  CornerRadius="10" Grid.Column="0" Grid.Row="0" Background="#dbd8dc" Margin="5,5,5,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="400"></ColumnDefinition>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                            <ColumnDefinition Width="500"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{StaticResource TitleTextStyle}" Name="PageTitle" FontFamily="Microsoft YaHei UI"><TextBlock Text="{Binding Path=CompanyName}"  DataContext="{Binding Infos}"></TextBlock> | <TextBlock Text="{Binding Path=StoreName}" DataContext="{Binding Infos}"></TextBlock></TextBlock>
                        <StackPanel Grid.Column="2">
                            <ChildPages:NoticeControl Width="Auto" Margin="0,0,50,0"/>
                        </StackPanel>
                    </Grid>

                </Border>
                <Grid Grid.Column="1" Grid.Row="0">
                    <Button Style="{StaticResource BtnExitStyle}" Click="Button_Click_Exit" TabIndex="13">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <Image Source="Images\exit.png" Width="25"></Image>
                                <TextBlock Margin="5,0,0,0">安全退出</TextBlock>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </Grid>
                <Border  Grid.Column="0" Grid.Row="1" Background="#E0E3E8" CornerRadius="10,10,5,5" Margin="10,0,10,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"></RowDefinition>
                            <RowDefinition Height="50"></RowDefinition>
                        </Grid.RowDefinitions>
                        <DataGrid CanUserDeleteRows="True" TabIndex="14" Margin="0" PreviewKeyDown="DataGridGoods_PreviewKeyDown" Foreground="#4B4B4B" BorderBrush="#5C5753" BorderThickness="0" VerticalGridLinesBrush="Transparent" HorizontalGridLinesBrush="#D6DBE9" CanUserSortColumns="False" CanUserAddRows="False" CanUserReorderColumns="False" HeadersVisibility="Column"  AutoGenerateColumns="False" x:Name="DataGridGoods">

                            <DataGrid.Columns>
                                <DataGridTextColumn FocusManager.IsFocusScope="False" Width="*" MaxWidth="40" SortDirection="Ascending" CanUserReorder="False" CanUserResize="False" CanUserSort="False" Header="" IsReadOnly="True" Binding="{Binding Id,Mode=TwoWay}"></DataGridTextColumn>
                                <DataGridTextColumn FocusManager.IsFocusScope="False"  CanUserSort="False" Width="*" MinWidth="140" MaxWidth="160" Header="条码" IsReadOnly="True" Binding="{Binding ShowCode,Mode=TwoWay}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Height" Value="auto"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn FocusManager.IsFocusScope="False"  Width="*" MaxWidth="450" CanUserSort="False" Header="品名" IsReadOnly="True" Binding="{Binding Name,Mode=TwoWay}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Height" Value="auto"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTemplateColumn IsReadOnly="True" CanUserSort="False" MaxWidth="150" Width="*" Header="数量">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid VerticalAlignment="Center" HorizontalAlignment="Center">

                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                    <ColumnDefinition Width="120*"></ColumnDefinition>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Num,Mode=TwoWay}" Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource OperationConverter},ConverterParameter='Num'}" Grid.Column="1"></TextBlock>
                                                <Grid Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource IsEditConverter},ConverterParameter='Num'}" Width="{TemplateBinding Width}" Grid.Column="1" Height="{TemplateBinding Height}"  HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="15"></ColumnDefinition>
                                                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                                                        <ColumnDefinition Width="15"></ColumnDefinition>
                                                    </Grid.ColumnDefinitions>
                                                    <Button  Grid.Column="0" Command="{Binding PlusStep}"  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"  Style="{StaticResource BtnBase}" BorderThickness="0" Height="15" Width="15" Background="Transparent">
                                                        <Image Width="15" Height="15" Source="Images\plus.png"></Image>
                                                    </Button>

                                                    <TextBox Loaded="txtNumLoad" PreviewGotKeyboardFocus="TextBox_PreviewGotKeyboardFocus" Grid.Column="1"  Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource IsEditConverter},ConverterParameter='Num'}" Margin="0"  TabIndex="15">
                                                        <TextBox.Text>
                                                            <Binding Path="BeforeSaveNum" UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True">
                                                                <Binding.ValidationRules>
                                                                    <rules:DoubleRules MinValue="0" MinErrorInfo="商品数量不能为负数！" NaNErrorInfo="请输入正确的商品数量！"></rules:DoubleRules>
                                                                </Binding.ValidationRules>
                                                            </Binding>
                                                        </TextBox.Text>
                                                    </TextBox>

                                                    <Button Grid.Column="2" Command="{Binding MinusStep}"  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"  Style="{StaticResource BtnBase}"  BorderThickness="0" Height="15" Width="15" Background="Transparent">
                                                        <Image Width="15" Height="15" Source="Images\minus.png"></Image>
                                                    </Button>
                                                </Grid>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>

                                </DataGridTemplateColumn>


                                <DataGridTextColumn FocusManager.IsFocusScope="False"  CanUserSort="False" MaxWidth="40" Width="*" Header="单位" IsReadOnly="True" Binding="{Binding Unit,Mode=TwoWay}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Height" Value="auto"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <!--<DataGridTextColumn FocusManager.IsFocusScope="False"  CanUserSort="False" Width="*" Header="单价" IsReadOnly="True" Binding="{Binding Price,Mode=TwoWay,StringFormat='{}{0:N}'}"></DataGridTextColumn>-->
                                <DataGridTemplateColumn IsReadOnly="True" CanUserSort="False" MaxWidth="150" Width="*" Header="单价">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                    <ColumnDefinition Width="120*"></ColumnDefinition>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Sale,Mode=TwoWay,StringFormat='{}{0:N}'}" Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource OperationConverter},ConverterParameter='Sale'}" Grid.Column="1">10</TextBlock>
                                                <TextBox Loaded="txtSaleLoad"  PreviewGotKeyboardFocus="TextBox_PreviewGotKeyboardFocus" TabIndex="16"  Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource IsEditConverter},ConverterParameter='Sale'}" Grid.Column="1">
                                                    <TextBox.Text>
                                                        <Binding Path="BeforeSaveSale" ValidatesOnExceptions="True" NotifyOnValidationError="True"  UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True">
                                                            <Binding.ValidationRules>
                                                                <rules:DoubleRules MinValue="0" MinErrorInfo="折后价格或者特价不能为负数！" NaNErrorInfo="请输入正确的折后价格或者特价！" ></rules:DoubleRules>
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </TextBox.Text>
                                                </TextBox>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn FocusManager.IsFocusScope="False"  CanUserSort="False" MinWidth="120" Width="*" Header="小计" IsReadOnly="True" Binding="{Binding Total,Mode=TwoWay,StringFormat='{}{0:N}'}"></DataGridTextColumn>
                                <DataGridTemplateColumn FocusManager.IsFocusScope="False"  CanUserSort="False" IsReadOnly="True" MinWidth="110" Width="*" Header="操作">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                    <ColumnDefinition Width="50"></ColumnDefinition>
                                                    <ColumnDefinition Width="5"></ColumnDefinition>
                                                    <ColumnDefinition Width="50"></ColumnDefinition>
                                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                                </Grid.ColumnDefinitions>
                                                <Button Style="{StaticResource BtnBase}" Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource OperationConverter}}" Command="{Binding GotoEdit}"  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"  BorderBrush="#D7D7D7" Width="50" Foreground="#4B4B4B" Height="30"  BorderThickness="1" FontSize="12" Background="#FFFFFF" Grid.Column="1">编辑</Button>
                                                <Button Style="{StaticResource BtnBase}" Visibility="{Binding Current,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,Converter={StaticResource OperationConverter}}" Command="{Binding Remove}"  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"  BorderBrush="#B85D5C" Width="50" Foreground="#B85D5C" Height="30"  BorderThickness="1" FontSize="12" Background="#FFFFFF"  Grid.Column="3">移除</Button>
                                                <Button TabIndex="17"  Style="{StaticResource BtnBase}" Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource IsEditConverter}}" Command="{Binding Save}" BorderBrush="#A0B888" Width="50" Foreground="#A0B888" Height="30"  BorderThickness="1" FontSize="12" Background="#FFFFFF" Grid.Column="1">保存</Button>
                                                <Button TabIndex="18"  Style="{StaticResource BtnBase}" Visibility="{Binding Current,Mode=TwoWay,Converter={StaticResource IsEditConverter}}" Command="{Binding ExitEdit}" BorderBrush="#7E7E7E" Width="50" Foreground="#7E7E7E" Height="30"  BorderThickness="1" FontSize="12" Background="#FFFFFF"  Grid.Column="3">取消</Button>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>

                        </DataGrid>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="8,10">
                            <TextBlock VerticalAlignment="Center" FontWeight="Bold" FontSize="18" Margin="0,0,10,0">条码:</TextBlock>
                            <TextBox Name="txtBarCode" Width="200" VerticalContentAlignment="Center" FontSize="16" TabIndex="2"  PreviewGotKeyboardFocus="TextBox_PreviewGotKeyboardFocus">
                                <TextBox.Text>
                                    <Binding Mode="TwoWay" Path="BarCode" ValidatesOnExceptions="True" NotifyOnValidationError="True"  UpdateSourceTrigger="LostFocus" ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <rules:GoodsBarCodeRules></rules:GoodsBarCodeRules>
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>
                        </StackPanel>
                    </Grid>
                </Border>
                <StackPanel x:Name="PMenu" Margin="0,0,0,10" Grid.Column="1" Grid.Row="1" Cursor="Hand">
                    <Border Background="#E0E3E8"  CornerRadius="5" Height="{Binding ElementName=PMenu,Path=ActualHeight}">
                        <Grid x:Name="PMenu_Grid">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="75"></RowDefinition>
                                <RowDefinition Height="*"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Button Grid.Row="0" Style="{StaticResource MainButtonStyle}" Click="BtnChaKuCun_Click" TabIndex="7">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\search.png" Width="30" Margin="-8,0,0,0"></Image>
                                        <TextBlock Margin="10,0,0,0">查库存</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                            <Button Grid.Row="1" Style="{StaticResource MainButtonStyle}" Click="BtnChaJiaGe_Click" TabIndex="8">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\price1.png" Width="30" Margin="-8,0,0,0"></Image>
                                        <TextBlock Margin="10,0,0,0">查价格</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                            <Button Grid.Row="2" Style="{StaticResource MainButtonStyle}" Click="BtnRuKuan_Click" TabIndex="9">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\churukuan.png" Margin="-8,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="10,0,0,0">出入款</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                            <!--<Button Grid.Row="3" Style="{StaticResource MainButtonStyle}" Click="BtnChuKuan_Click" TabIndex="10">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\out.png" Margin="-8,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="15,0,15,0">出款</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>-->
                            <!--<Button Grid.Row="4" Style="{StaticResource MainButtonStyle}" Click="BtnBanJie_Click" TabIndex="10">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\banjie.png" Margin="-8,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="15,0,15,0">交班</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>-->
                            <Button Grid.Row="3" Style="{StaticResource MainButtonStyle}" Click="BtnRiJie_Click" TabIndex="10">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\rijie.png" Margin="-8,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="15,0,15,0">日结</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                            <!--<Button Grid.Row="6" Style="{StaticResource MainButtonStyle}" Click="BtnDuiZhang_Click" TabIndex="11">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal" Background="#E0E3E8">
                                        <Image Source="Images\check.png" Margin="-8,0,0,0" Width="30" ></Image>
                                        <TextBlock Margin="15,0,15,0">对帐</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>-->
                            <Button Grid.Row="4" Style="{StaticResource MainButtonStyle}" Click="BtnTuiHuanHuo_Click" TabIndex="11">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\change.png" Margin="-20,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="10,0,0,0">退换货</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                            <Button Grid.Row="5" Style="{StaticResource MainButtonStyle}" Click="BtnDataSync_Click" TabIndex="12">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal"  Background="#E0E3E8">
                                        <Image Source="Images\data.png" Margin="0,0,0,0" Width="30"></Image>
                                        <TextBlock Margin="10,0,0,0">传数据</TextBlock>
                                    </StackPanel>
                                </Button.Content>
                            </Button>

                        </Grid>

                    </Border>
                </StackPanel>
            </Grid>
            <!--bottom-->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition MinWidth="280" MaxWidth="340"></ColumnDefinition>
                    <ColumnDefinition MinWidth="320"></ColumnDefinition>
                    <ColumnDefinition MinWidth="380" MaxWidth="410"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0" Name="gridMembershipCard">
                    <Border Background="#DBDCDE" CornerRadius="5"  Margin="10,0">
                        <StackPanel Margin="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Margin="0,6" VerticalAlignment="Center" Style="{ StaticResource TxtCardTitle}">手机号：</TextBlock>
                                <TextBox Name="txtMemberCard" Height="35" Width="220" FontSize="14" VerticalContentAlignment="Center" TabIndex="0"  PreviewGotKeyboardFocus="TextBox_PreviewGotKeyboardFocus">
                                    <TextBox.Text>
                                        <Binding Path="Id" Mode="TwoWay" ValidatesOnExceptions="True" NotifyOnValidationError="True"  UpdateSourceTrigger="LostFocus" ValidatesOnDataErrors="True">
                                            <Binding.ValidationRules>
                                                <rules:Mobile ErrorInfo="请输入正确手机号！"></rules:Mobile>
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,15">
                                <TextBlock  VerticalAlignment="Center" Margin="0,6" Style="{ StaticResource TxtCardTitle}">微信号：</TextBlock>
                                <TextBox Name="txtWeixin" Width="220" FontSize="14"  Height="35" VerticalContentAlignment="Center" TabIndex="1"  PreviewGotKeyboardFocus="TextBox_PreviewGotKeyboardFocus">
                                    <TextBox.Text>
                                        <Binding Path="Weixin" Mode="TwoWay" ValidatesOnExceptions="True" NotifyOnValidationError="True"  UpdateSourceTrigger="LostFocus" ValidatesOnDataErrors="True">
                                            <Binding.ValidationRules>
                                                <rules:Weixin ErrorInfo="请输入正确微信号！"></rules:Weixin>
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                            </StackPanel>
                            <!--<StackPanel Orientation="Horizontal" Margin="0,5">
                                <TextBlock Margin="0,6" Style="{ StaticResource TxtCardTitle}">持卡人：</TextBlock>
                                <TextBlock Margin="-12,6" Text="{Binding Name,Mode=TwoWay}" Style="{StaticResource TxtCardInfo}"></TextBlock>
                            </StackPanel>-->
                            
                            <StackPanel Orientation="Horizontal" Margin="0,5">
                                <TextBlock Margin="0,6"  Style="{ StaticResource TxtCardTitle}">操作人：</TextBlock>
                                <TextBlock  Text="{Binding UserCode,Mode=TwoWay}" Margin="0,6" Style="{StaticResource ResourceKey=TxtCardInfo}" ></TextBlock>

                                <TextBlock  Text="{Binding Operator,Mode=TwoWay}" Margin="10,6" Style="{StaticResource ResourceKey=TxtCardInfo}" ></TextBlock>
                                <TextBlock Margin="10,6"  Text="{Binding OperatedTime,StringFormat='HH:mm:ss',Mode=TwoWay}" Style="{StaticResource TxtCardInfo}"></TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
                <Grid Grid.Column="1">
                    <Border Background="#DBDCDE" CornerRadius="5">
                        <Grid x:Name="gridTotalPanel">
                            <StackPanel HorizontalAlignment="Left" Margin="10,30,0,20">

                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Margin="0" FontSize="30" Style="{ StaticResource TxtCardTitle}">应收：</TextBlock>
                                    <TextBlock Margin="0" Text="{Binding Receivable,StringFormat='{}{0:C}'}" 
                                              FontSize="31" Style="{ StaticResource TxtCardTitle}" Foreground="#598514"></TextBlock>
                                </StackPanel>
                                <StackPanel  Orientation="Horizontal" VerticalAlignment="Center" Margin="0,15,0,0">
                                    <TextBlock Margin="10,0,0,0"></TextBlock>
                                    <TextBlock FontSize="18" Foreground="#598514">已优惠：</TextBlock>
                                    <TextBlock Text="{Binding Preferential,StringFormat='{}{0:C}'}"  Margin="5,0,0,0"
                                               FontSize="18" Foreground="#598514"></TextBlock>
                                </StackPanel>


                                <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                    <TextBlock Margin="27,0,0,0"></TextBlock>
                                    <TextBlock  Style="{ StaticResource TxtCardTitle}"  FontSize="18" >件数：</TextBlock>
                                    <TextBlock  FontSize="18" Text="{Binding GoodsCount}" Margin="-5,0,0,0" Style="{StaticResource TxtCardInfo}"></TextBlock>
                                </StackPanel>
                            </StackPanel>
                            <Image Visibility="{Binding ShowGiftIcon,Mode=OneWay}" Cursor="Hand" Source="Images\sales-1.png" Height="60" Margin="0,0,20,20"  MouseDown="HasGiftImage_MouseDown" VerticalAlignment="Bottom" HorizontalAlignment="Right"></Image>
                        </Grid>
                    </Border>
                </Grid>
                <Grid Grid.Column="2" Margin="10,0,10,0">
                    <Border Background="#DBDCDE" CornerRadius="5">
                        <Grid >
                            <Grid.RowDefinitions>
                                <RowDefinition Height="100"></RowDefinition>
                                <RowDefinition Height="70"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" MinWidth="140" MaxWidth="250"></ColumnDefinition>
                                <ColumnDefinition Width="*" MinWidth="100" MaxWidth="150"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Button Style="{StaticResource BtnJieSuan}" Width="Auto" Margin="10,20,5,6" MinHeight="65" Grid.Column="0" Grid.Row="0" Click="BtnJieSuan_Click"  TabIndex="3">结算</Button>
                            <Button Style="{StaticResource BtnCannel}" Width="Auto"  Margin="5,20,10,6" Grid.Column="1" Grid.Row="0" Command="{Binding Path=Cannel}"  CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"  TabIndex="4">清空</Button>
                            <Button Style="{StaticResource BtnBottom}" Width="Auto" Margin="10,10,5,15" Grid.Column="0" Grid.Row="1"  Click="BtnZhengDanZheKou_Click" TabIndex="5">整单折扣</Button>
                            <Button Style="{StaticResource BtnBottom}"  Width="Auto" Margin="5,10,10,15" FontSize="18" Content="{Binding Converter={StaticResource GuaDanNumShowConverter},Path=LocalBills.Count,Mode=TwoWay}" Grid.Column="1" Grid.Row="1" Click="BtnGuaDan_Click" TabIndex="6"></Button>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="610"></ColumnDefinition>
                    <ColumnDefinition Width="440*"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="160"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <StackPanel Margin="10,0,0,0" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <TextBlock FontSize="14" Foreground="White">机号：</TextBlock>
                    <TextBlock Text="{Binding Path=MachineId}" DataContext="{Binding Infos}" FontSize="14" Foreground="#85DF4A" Margin="0,0,10,0"></TextBlock>
                    <StackPanel Cursor="Hand" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Width="110" MouseDown="StatusSwitch_MouseDown">
                        <TextBlock FontSize="14" Foreground="White">销售状态：</TextBlock>
                        <TextBlock Text="{Binding ShowStatus}" FontSize="14" Foreground="#85DF4A" Margin="0,0,20,0"></TextBlock>
                    </StackPanel>
                    <StackPanel Cursor="Hand" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Width="110" MouseDown="OparetStatus_MouseDown">
                        <TextBlock FontSize="14" Foreground="White">操作：</TextBlock>
                        <TextBlock Text="{Binding OparetStatus}" FontSize="14" Foreground="#85DF4A" Margin="0,0,20,0"></TextBlock>
                    </StackPanel>
                    <StackPanel Cursor="Hand" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Width="110" MouseDown="PrinterStatus_MouseDown">
                        <TextBlock FontSize="14" Foreground="White">小票打印：</TextBlock>
                        <TextBlock Text="{Binding PrinterStatus}" FontSize="14" Foreground="#85DF4A" Margin="0,0,20,0"></TextBlock>
                    </StackPanel>
                    <TextBlock FontSize="14" Foreground="White">出货仓：</TextBlock>
                    <TextBlock Text="{Binding Path=StoreName}" DataContext="{Binding Infos}" FontSize="14" Foreground="#85DF4A"></TextBlock>
                </StackPanel>
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Grid.Column="1">
                    <TextBlock Text="{Binding ShowInMainWindowKeyboardShortcuts}" TextAlignment="Center" Padding="0" FontSize="12" Foreground="White"></TextBlock>
                </StackPanel>
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Grid.Column="3">
                    <TextBlock FontSize="14" FontWeight="Normal" Foreground="White">道诚科技 · 商业管理软件</TextBlock>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>
