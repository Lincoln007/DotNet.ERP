@{
    ViewBag.Title = "ExportOption";
    Layout = "~/Views/Shared/_FormLayout.cshtml";
}<style type="text/css">
    .cate {
        height: 35px;
    }
    .category {
        padding-right: 20px;
        display: inline-block;
    }
    .category img {
        cursor: pointer;
        padding-left: 5px;
    }
</style>
<div class="default-form" style="margin:15px;">
    <form id="frm" action="@Url.Action("ExportWeight")" method="get">
        <table>
            <tr class="cate">
                <td align="right">门 店：</td>
                <td>@Html.DropDownList("store", ViewBag.stores as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "editable:false,width:150,onChange:function(n,o){$('#selectCategoryText').html('')}" })</td>
            </tr>
            <tr class="cate">
                <td align="right">热键插片：</td>
                <td>@Html.RadioButtonList(new List<SelectListItem>() { new SelectListItem() { Value = "112", Selected = true }, new SelectListItem() { Value = "224" } }, "MaxRecord")</td>
            </tr>
            <tr class="cate">
                <td align="right">称重品类：</td>
                <td>@Form.CategoryCombobox("Category", showThird: true, panelWidth: 350, controlWidth: 160)  <a href="#" class="easyui-linkbutton" onclick="addCategory()">添加品类</a></td>
            </tr>
        </table>
        <div id="selectCategoryText" style="width: 100%;line-height:28px;"></div>
    </form>
</div>
<script type="text/javascript">
    function SaveBefore() {
        if (!$("[name='selectCategorySN']")[0] || $("[name='selectCategorySN']").val() == "") {
            alert("请先选择品类!"); return false;
        }
        setTimeout(function () {
            pharos.easyui.dialog.topClose("formDiv");
        }, 1000);
        return true;
    }
    function addCategory() {
        var val = $("#Category_0").combobox("getValue");
        var txt = $("#Category_0").combobox("getText");
        if (!val) {
            $.messager.alert("提示", "请选择品类!", "info"); return;
        }
        var vals = $.map($("[name='selectCategorySN']"), function (r) {
            return $(r).val();
        })
        if (vals.indexOf(val) != -1) {
            $.messager.alert("提示", "该品类已存在!", "warning"); return;
        }
        $.post("@Url.Action("GetNumByCatesn")", {catesn:val,storeId:$("#store").combobox("getValue"),t:Math.random()}, function (num) {
            var text = "<span class='category'><input type='hidden' name='selectCategorySN' value='" + val + "'/><label style='display:inline-block;'>" + txt+"("+num+")</label><img src='" + root + "Content/image/close.png' width='12' height='12' onclick='delCategory(this)' /></span>";
            $(text).appendTo($("#selectCategoryText"));
        })
    }
    function delCategory(obj) {
        $(obj).parent().remove();
    }
</script>