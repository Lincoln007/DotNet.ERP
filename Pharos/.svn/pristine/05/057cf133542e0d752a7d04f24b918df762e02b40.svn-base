@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_ManagerLayout.cshtml";
    ViewData.OpBtnInfo(new OpBtnInfo(hideAdd: true, hideEdit: true, hideDel: true, searchHeight: 80));
}

@section search{
    <table class="table-toolbar">
        <tr>
            <td class="label-toolbar">
                <label>品类：</label>
            </td>
            <td class="input-toolbar">
                @Form.CategoryCombobox("parentType", showThird: true, panelWidth: 350, controlWidth:200)
            </td>
            <td class="label-toolbar">
                <label>供应商：</label>
            </td>
            <td class="input-toolbar">
                @Form.SupplierCombobox("supplierId", controlWidth: 200, multiple: true, emptyTitle: "全部")
            </td>
            <td class="label-toolbar">
                <label>关键字：</label>
            </td>
            <td class="input-toolbar">
                <input name="searchText" id="searchText" class="datacontrol easyui-textbox font-12" placeholder="货号/品名/条码" data-options="prompt:'货号/品名/条码'" style="width:120px;" />
            </td>
        </tr>
        <tr>
            <td class="label-toolbar">
                <label>门店：</label>
            </td>
            <td class="input-toolbar">
                @Form.Combobox("store", ViewBag.stores as List<SelectListItem>, dataOptions: (CurrentUser.IsStore ? "readonly:true," : "") + "editable:false",controlWidth:200)
            </td>
            <td class="label-toolbar">
                <label>起止日期：</label>
            </td>
            <td class="input-toolbar">
                <input name="date" class="Wdate datacontrol" style="width: 120px;" />
                <label style="width:10px;">-</label>
                <input name="date2" class="Wdate datacontrol" style="width: 120px;" />
            </td>
        </tr>
    </table>
}
@section toolbar
{
    <a href="#" id="btnExcel" class="easyui-linkbutton cus1 linkbtn" data-options="iconCls:'icon-export'" onclick="Export()">导出Excel</a>
}
<script type="text/javascript">
    pharos.manager.geturl = '@Url.Action("StoreStockDetails")';
    pharos.manager.pagination = true;
    pharos.manager.showFooter = true;
    pharos.manager.pageSize = 50;
    pharos.manager.pageList = [50, 100, 200];
    pharos.manager.columns = [[
        { field: 'SubUnit', title: '单位', width: 70 },
        { field: 'StoreTitle', title: '门店', width: 180 },
        { field: 'BalanceDate', title: '日 期', width: 120 },
        { field: 'StockNumber', title: '库存数量', width: 100 },
        { field: '平均成本价', title: '平均成本价', width: 110 },
        { field: '售价金额', title: '库存售价金额', width: 120, formatter: numberToFixed },
        { field: '成本金额含', title: '成本金额(含)', width: 120, formatter: numberToFixed },
        { field: '成本金额未', title: '成本金额(未)', width: 120, formatter: numberToFixed },
        { field: '当前零售价', title: '当前零售价', width: 110, formatter: numberToFixed },
        { field: 'SupplierTitle', title: '参考供应商', width: 120 }
    ]];
    pharos.manager.frozenColumns = [[
        { field: 'CategoryTitle', title: '品类', width: 150 },
        { field: 'ProductCode', title: '商品编码', width: 70 },
        { field: 'Barcode', title: '商品条码', width: 120 },
        { field: 'Title', title: '商品名称', width: 140 }
    ]]
    pharos.manager.loadSuccess = function () {
        if ($("[name='date']").val() == $("[name='date2']").val())
            pharos.manager.$dg.datagrid("hideColumn", "BalanceDate");
        else
            pharos.manager.$dg.datagrid("showColumn", "BalanceDate");
        pharos.manager.$dg.datagrid("autoSubTotalGroupby", { groupby: 'CategoryTitle', columns: ['StockNumber', '售价金额', '成本金额含', '成本金额未'] });
    }
    function Export() {
        var date=$("[name='date']").val();
        if (!date) {
            $.messager.alert("提示", "请先选择日期!"); return;
        }
        window.location.href = '@Url.Action("SaleExport")?type=13&' + $('#frmsearch').serialize();
    }
    $(function () {
        $("#btnExcel").insertAfter($("#searchBtn"));
        $("#toolbar").hide();
    });
</script>