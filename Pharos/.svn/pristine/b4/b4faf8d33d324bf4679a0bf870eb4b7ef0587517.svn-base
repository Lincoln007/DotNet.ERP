@model Pharos.Sys.Entity.SysWebSetting
@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_FormLayout.cshtml";
}

<style>
    body { text-align: center; }
</style>
<div class="default-form">
@*@using (Html.BeginForm())
{*@
@using (Html.BeginForm("WebSetting", "SysAdmin", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="WebSettingBox">
        @Html.HiddenFor(o=>o.Id)
        <table class="table">
            <tr>
                <td class="leftTd title">
                    基本信息 :
                </td>
                <td class="rightTd"></td>
                <td class="leftTd"></td>
                <td class="rightTd"></td>
            </tr>
            <tr>
                <td class="leftTd">顶部Logo : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "easyui-textbox datacontrol", id = "topLogo", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "imgInput", id = "hidTopLogo", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })           
                </td>
                <td colspan="2" style="text-align:left; line-height:30px;border:1px solid red">
                    <img src="~/@Model.TopLogo" height="40" style=" border:1px solid red; " />
                </td>
            </tr>

            <tr>
                <td class="leftTd">顶部Logo : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "easyui-textbox datacontrol", id = "topLogo", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "imgInput", id = "hidTopLogo", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })        
                </td>
                <td class="leftTd">底部Logo : </td>
                <td class="rightTd">
                    @*@Html.LabelFor(o => o.BottomLogo, Model.BottomLogo, new { @class = "label",name="BottomLogo", id = "BottomLogo" })*@
                    @Html.TextBoxFor(o => o.BottomLogo, new { @class = "imgInput", data_options = "required:true,novalidate:true" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">系统Icon : </td>
                <td class="rightTd">
                    @*@Html.LabelFor(o => o.SysIcon, Model.SysIcon, new { @class = "label", name = "SysIcon", id = "SysIcon" })*@
                    @Html.TextBoxFor(o => o.SysIcon, new { @class = "imgInput", data_options = "required:true,novalidate:true" })
                </td>
                <td class="leftTd">官网地址 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.WebsiteUrl, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype="url", invalidmessage="网址格式不正确,正确示例： http://www.example.com"})
                </td>
            </tr>
            <tr>
                <td class="leftTd">公司简称 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.CompanyTitle, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true",validtype="length[1,50]" })
                </td>
                <td class="leftTd">公司电话 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.Tel, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true",validtype="phone" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">页面Title : </td>
                <td class="rightTd" colspan="3">
                    @Html.TextBoxFor(o => o.PageTitle, new { @class = "easyui-textbox datacontrol inputFull", data_options = "required:true,novalidate:true", validtype = "length[1,50]" })
                </td>                
            </tr>
            <tr>
                <td class="leftTd title" colspan="4">
                    SMTP :
                </td>
            </tr>
            <tr>
                <td class="leftTd">服务器 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPServer, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,100]" })
                </td>
                <td class="leftTd">端口号 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPPort, new { @class = "easyui-textbox datacontrol", data_options = "novalidate:true", validtype = "integer" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">显示名称 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPShowName, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">SSL端口 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPSSLPort, new { @class = "easyui-textbox datacontrol", data_options = "novalidate:true", validtype = "integer" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">账号 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPAccount, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "email length[1,100]" })
                </td>
                <td class="leftTd">密码 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPPwd, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[4,20]", type = "password" })
                </td>
            </tr>
            <tr>
                <td class="leftTd title" colspan="4">
                    环信IM :
                </td>
            </tr>
            <tr>
                <td class="leftTd">Url : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMReqUrlBase, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">Id : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppId, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">Secret : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppSecret, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">org_name : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppOrg, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">app_name : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppName, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd"></td>
                <td class="rightTd"></td>
            </tr>      
        </table>

        <div class="buttonBox">
            <a class="easyui-linkbutton cus4 linkbtn btn" onclick="$('form').submit();">保存</a>
            <a class="easyui-linkbutton cus4 linkbtn btn" onclick="window.location.reload();" style="float:right;">重置</a>
        </div>

    </div>   
}
</div>

<script type="text/javascript">
    //function getTopLogo() {  
    //    //var topLogo = $("#TopLogo").val();
    //    //var hidTopLogo = $("#hidTopLogo").val();

    //    var $topLogo = $("#topLogo");
    //    var $hidTopLogo = $("#hidTopLogo");
    //    $hidTopLogo.click();
    //}
    
    function SaveBefore() {
        //限制图片上传的格式
        var filepath = $("input[id='hidTopLogo']").val();
        var extStart = filepath.lastIndexOf(".");
        var ext = filepath.substring(extStart, filepath.length).toUpperCase();
        if ((filepath != null) && (filepath != "") && (ext != ".PNG")) {
            alert("附件格式不正确！只能上传png类型的图片！");
            return false;
        }
        return true;
    }

    //点击文本框，触发选择文件按钮
    $(function () {        debugger
        $("input", $("#topLogo").next("span")).click(function () {
            $("#hidTopLogo").click();
        });
        //var hidTopLogo = document.getElementById("hidTopLogo").value;
    })

    //将选择的文件名复制到文本框
    function addFileNameToInput() {  debugger
        document.getElementById("topLogo").value = document.getElementById("hidTopLogo").value;
    }

    //将选择的文件名复制到文本框 方法二
    var file = $('#topLogo'),
	aim = $('#hidTopLogo');
    file.on('change', function (e) {
        var name = e.currentTarget.files[0].name;
        aim.val(name);
    });

   

</script>
