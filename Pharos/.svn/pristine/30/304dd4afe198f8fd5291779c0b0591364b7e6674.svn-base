@model Pharos.Sys.Entity.SysWebSetting
@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_FormLayout.cshtml";
}

<style>
    body { text-align: center; }
</style>
<div class="default-form">
@*@using (Html.BeginForm())
{*@
@using (Html.BeginForm("WebSetting", "SysAdmin", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="WebSettingBox">
        @Html.HiddenFor(o=>o.Id)
        <table class="table">
            <tr>
                <td class="leftTd title">
                    基本信息 :
                </td>
                <td class="rightTd"></td>
                <td class="leftTd"></td>
                <td class="rightTd"></td>
            </tr>
            <tr>
                <td class="leftTd">顶部Logo : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "easyui-textbox datacontrol", id = "topLogo", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.TopLogo, new { @class = "imgInput", id = "hidTopLogo", type = "file", onchange = "addFileNameToInput()", style="display:none;" })
                </td>
                <td colspan="2" >
                    <div style="text-align: left; height: 30px; padding-top: 2px; padding-bottom: 3px;">
                        <img src="~/@Model.TopLogo" height="30"/>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="leftTd">底部Logo : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.BottomLogo, new { @class = "easyui-textbox datacontrol", id = "bottomLogo", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.BottomLogo, new { @class = "imgInput", id = "hidBottomLogo", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })
                </td>
                <td colspan="2">
                    <div style="text-align: left; height: 30px; padding-top: 2px; padding-bottom: 3px;">
                        <img src="~/@Model.BottomLogo" height="30" />
                    </div>
                </td>
            </tr>
            <tr>
                <td class="leftTd">App Icon : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.AppIcon, new { @class = "easyui-textbox datacontrol", id = "appIcon", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.AppIcon, new { @class = "imgInput", id = "hidAppIcon", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })
                </td>
                <td colspan="2">
                    <div style="text-align: left; height: 30px; padding-top: 2px; padding-bottom: 3px;">
                        <img src="~/@Model.AppIcon" height="30" />
                    </div>
                </td>
            </tr>
            <tr>
                <td class="leftTd">App首页背景 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.AppCustomer, new { @class = "easyui-textbox datacontrol", id = "appCustomer", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.AppCustomer, new { @class = "imgInput", id = "hidAppCustomer", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })
                </td>
                <td colspan="2">
                    <div style="text-align: left; height: 30px; padding-top: 2px; padding-bottom: 3px;">
                        <img src="~/@Model.AppCustomer" height="30" />
                    </div>
                </td>
            </tr>
            <tr>
                <td class="leftTd">系统Icon : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SysIcon, new { @class = "easyui-textbox datacontrol", id = "sysIcon", data_options = "required:true,novalidate:true,editable:false" })
                    @Html.TextBoxFor(o => o.SysIcon, new { @class = "imgInput", id = "hidSysIcon", type = "file", onchange = "addFileNameToInput()", style = "display:none;" })
                </td>
                <td colspan="2">
                    <div style="text-align: left; height: 30px; padding-top: 2px; padding-bottom: 3px;">
                        <img src="~/@Model.SysIcon" height="30" />
                    </div>
                </td>
            </tr>

            <tr>
                <td class="leftTd">公司简称 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.CompanyTitle, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true",validtype="length[1,50]" })
                </td>
                <td class="leftTd">公司电话 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.Tel, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true",validtype="phone" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">官网地址 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.WebsiteUrl, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })

                </td>
                <td class="leftTd">页面Title : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.PageTitle, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,50]" })
                </td>
            </tr>           
            <tr>
                <td class="leftTd title" colspan="4">
                    SMTP :
                </td>
            </tr>
            <tr>
                <td class="leftTd">服务器 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPServer, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,100]" })
                </td>
                <td class="leftTd">端口号 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPPort, new { @class = "easyui-textbox datacontrol", data_options = "novalidate:true", validtype = "integer" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">显示名称 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPShowName, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">SSL端口 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPSSLPort, new { @class = "easyui-textbox datacontrol", data_options = "novalidate:true", validtype = "integer" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">账号 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPAccount, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "email length[1,100]" })
                </td>
                <td class="leftTd">密码 : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.SMTPPwd, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[4,20]", type = "password" })
                </td>
            </tr>
            <tr>
                <td class="leftTd title" colspan="4">
                    环信IM :
                </td>
            </tr>
            <tr>
                <td class="leftTd">Url : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMReqUrlBase, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">Id : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppId, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">Secret : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppSecret, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd">org_name : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppOrg, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
            </tr>
            <tr>
                <td class="leftTd">app_name : </td>
                <td class="rightTd">
                    @Html.TextBoxFor(o => o.EMAppName, new { @class = "easyui-textbox datacontrol", data_options = "required:true,novalidate:true", validtype = "length[1,200]" })
                </td>
                <td class="leftTd"></td>
                <td class="rightTd"></td>
            </tr>      
        </table>

        <div class="buttonBox">
            <a class="easyui-linkbutton cus4 linkbtn btn" onclick="$('form').submit();">保存</a>
            <a class="easyui-linkbutton cus4 linkbtn btn" onclick="window.location.reload();" style="float:right;">重置</a>
        </div>

    </div>   
}
</div>

<script type="text/javascript">
    //function getTopLogo() {  
    //    //var topLogo = $("#TopLogo").val();
    //    //var hidTopLogo = $("#hidTopLogo").val();

    //    var $topLogo = $("#topLogo");
    //    var $hidTopLogo = $("#hidTopLogo");
    //    $hidTopLogo.click();
    //}
    
    function SaveBefore() {  
        //限制图片上传的格式
        var filepath = new Array(4);
        filepath[0] = $("input[id='hidTopLogo']").val();
        filepath[1] = $("input[id='hidBottomLogo']").val();
        filepath[2] = $("input[id='hidAppIcon']").val();
        filepath[3] = $("input[id='hidAppCustomer']").val();
        filepath[4] = $("input[id='hidSysIcon']").val();
        var str = "";
        var item = "";
        var count = 0;       
        for (var i = 0; i < 4; i++)  
        {
            var extStart = filepath[i].lastIndexOf(".");
            var ext = filepath[i].substring(extStart, filepath[i].length).toUpperCase();
            if ((filepath[i] != null) && (filepath[i] != "") && (ext != ".PNG")) {
                item = item + i.toString() + ",";
            }
            else {
                item = item + ",";
            }
        }
        var extStart4 = filepath[4].lastIndexOf(".");
        var ext4 = filepath[4].substring(extStart4, filepath[4].length).toUpperCase();
        if ((filepath[4] != null) && (filepath[4] != "") && (ext4 != ".ICO")) {
            item = item + "4";
        }

        var splitCount = item.split(",");
        if (splitCount[0] == "0")
        {
            str += "顶部Logo";
            count = count + 1;
        }
        if (splitCount[1] == "1")
        {
            if (count > 0) {
                str += "、底部Logo";
                count = count + 1;
            }
            else {
                str += "底部Logo";
                count = count + 1;
            }
        }
        if (splitCount[2] == "2") {
            if (count > 0) {
                str += "、App Icon";
                count = count + 1;
            }
            else {
                str += "App Icon";
                count = count + 1;
            }
        }
        if (splitCount[3] == "3") {
            if (count > 0) {
                str += "、App首页背景";
                count = count + 1;
            }
            else {
                str += "App首页背景";
                count = count + 1;
            }
        }
        if (count > 0)
        {
            str+="格式不正确，应为.png类型的图片！"
        }
        if (splitCount[4] == "4") {
            if (count > 0) {                                       
                str += "\n系统Icon格式不正确，应为.ico类型的图片！";
                count = count + 1;
            }
            else {
                str += "系统Icon格式不正确，应为.ico类型的图片！";
                count = count + 1;
            }
        }
        if (count > 0) {
            alert(str);
            return false;
        }
        return true;
    }

    //点击文本框，触发选择文件按钮
    $(function () {        
        $("input", $("#topLogo").next("span")).click(function () {
            $("#hidTopLogo").click();
        });
        //var hidTopLogo = document.getElementById("hidTopLogo").value;
        $("input", $("#bottomLogo").next("span")).click(function () {
            $("#hidBottomLogo").click();
        });
        $("input", $("#appIcon").next("span")).click(function () {
            $("#hidAppIcon").click();
        });
        $("input", $("#appCustomer").next("span")).click(function () {
            $("#hidAppCustomer").click();
        });
        $("input", $("#sysIcon").next("span")).click(function () {
            $("#hidSysIcon").click();
        });
    })

    //将选择的文件名复制到文本框
    function addFileNameToInput() {  
        document.getElementById("topLogo").value = document.getElementById("hidTopLogo").value;
    }

    //将选择的文件名复制到文本框 方法二
    var file = $('#topLogo'),
	aim = $('#hidTopLogo');
    file.on('change', function (e) {
        var name = e.currentTarget.files[0].name;
        aim.val(name);
    });

   

</script>
