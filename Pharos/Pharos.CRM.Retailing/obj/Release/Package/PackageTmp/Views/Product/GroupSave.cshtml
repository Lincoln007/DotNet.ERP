@model ProductRecord
@{
    ViewBag.Title = Pharos.Sys.SysConstPool.Page_Title;
    Layout = "~/Views/Shared/_FormLayout.cshtml";
}

<script type="text/javascript">
    $(function () {
        var subsn = $("#SubCategorySN").combobox("getValue");
        if (!subsn) {
            var csn = "@Model.BigCategorySN";
            $("#BigCategorySN").combobox("select", "").combobox("select", csn);
        }
    })
    function parentSelect(record) {
        $.post("@Url.Action("ParentTypeSelect")", { Id: record.value, t: Math.random() }, function (data) {
            $("#SubCategorySN").combobox("clear").combobox("loadData", data);
        }, "json");
    }
    var comboload=function (param, success, error) {
        //获取输入的值
        var q = param.q || "";
        //此处q的length代表输入多少个字符后开始查询
        if(q.length <= 1) return false;
        $.ajax({
            url:"@Url.Action("GetBrandInput", "Brand")",
            type:"post",
            data:{
                //传值，还是JSON数据搜索
                searchName:q
            },
            //重要，如果写jsonp会报转换错误，此处不写都可以
            dataType:"json",
            success: function (data) {
                //关键步骤，遍历一个MAP对象
                var items = $.map(data.rows, function(item){
                    return { value: item.BrandSN, text: item.Title };
                });
                //执行loader的success方法
                success(items);
            },    //异常处理
            error: function (xml, text, msg) {
                error.apply(this, arguments);
            }
        });
    }
</script>

<div class="default-form">
    @using(Html.BeginForm("Save","Product"))
    {
        @Html.HiddenFor(o=>o.Id)
        @Html.HiddenFor(o=>o.BuyPrice)
        @Html.HiddenFor(o=>o.Nature)
    <div class="content">
        <table class="table-form" width="100%" height="225px">
            <tr>
                <td class="name">所选商品：</td>
                <td colspan="3"></td>
            </tr>
            @foreach(var pro in Model.ProductGroups)
            {
                <tr>
                    <td colspan="4">
                        <table>
                            <tr><td>条码:@pro.GroupBarcode 名称:@pro.Title 数量:<input type="text" name="Number" value="@pro.Number" class="easyui-numberbox" data-options="precision:0,width:50" /></td></tr>
                        </table>
                    </td>
                </tr>
            }
            <tr>
                <td class="name">新货号：</td>
                <td class="input">@Html.TextBoxFor(o => o.ProductCode, new { @class = "easyui-textbox", data_options = "prompt:'系统自动生成',readonly:true" })</td>
                <td class="name">条形码：</td>
                <td class="input width-161">@Html.TextBoxFor(o => o.Barcode, new { @class = "easyui-textbox", data_options = "prompt:'系统自动生成',readonly:true" })</td>
            </tr>
            <tr>
                <td class="name">新品名：</td>
                <td class="input">@Html.TextBoxFor(o => o.Title, new { @class = "easyui-textbox", data_options = "required:true,novalidate:true" })</td>
                <td class="name">品 牌：</td>
                <td class="input">@Html.DropDownListFor(o => o.BrandSN, ViewBag.brands as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "editable:false" })</td>
            </tr>
            <tr>
                <td class="name">计量单位：</td>
                <td class="input">@Html.DropDownListFor(o => o.SubUnitId, ViewBag.subunits as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "editable:false" })</td>
                <td class="name">可组合数量：</td>
                <td class="input">@Model.GroupCount</td>
            </tr>
            <tr>
                <td class="name">品 类：</td>
                <td class="input">@Html.DropDownListFor(o => o.BigCategorySN, ViewBag.parenttypes as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "onSelect:parentSelect,editable:false" })</td>
                <td class="name">子 类：</td>
                <td class="input">@Html.DropDownListFor(o => o.SubCategorySN, ViewBag.childtypes as List<SelectListItem>, new { @class = "easyui-combobox", data_options = "editable:false" })</td>
            </tr>
            <tr>
                <td class="name">进 价：</td>
                <td class="input">@Model.BuyPrice</td>
                <td class="name">系统售价：</td>
                <td class="input">@Html.TextBoxFor(o => o.SysPrice, new { @class = "easyui-numberbox", data_options = "precision:2" })</td>
            </tr>
        </table>
    </div>
    }
</div>